# Chapter06 기본적인 리팩터링

-   또 다른 방법으로 여러 함수를 변환 함수로 묶기~, 단계 쪼개기

## 6.1 함수 추출하기 Extract Function

### 배경

-   함수 추출하기는 내가 가장 ~
-   하지만 내 눈에는 '목적과 구현을 분리'하는 방식이 가장 합리적인 기준으로 보인다.
-   내 경험상 함수 안에 들어갈 코드가 대여섯 줄을 넘어갈 때부터 ~ "오리지널 스몰토크"
-   함수가 짧으면 캐싱하기가 ~

### 절차

1. 함수를 새로 만들고 목적을 잘 드러내는 ~(무엇을)
    - 추출한 함수를 원래 함수 안에 중첩시킨다.~

## 6.2 함수 인라인하기 Inline Function

-   하지만 때로는 함수 본문이 이름만큼 명확한 경우도 있다. 또는 함수 본문 코드를 이름만큼 깔끔하게 리팩터링할 대도 있다.

## 6.3 변수 추출하기 Extract Variable

-   177 여기서 객체의 엄청난 장점을 볼 수 있다. ~

## 6.4 변수 인라인하기 Inline Variable

-   배경 : 변수 이름이 원래 표현식과 다를 바 없을 때 그 변수를 인라인하는 것이 좋다.

## 6.5 함수 선언 바꾸기 Change Function Declaration

-   배경 : 이름이 좋으면 함수의 구현 코드를 살펴볼 필요 없이 호출문만 보고도 무슨 일을 하는지 파악할 수 있다. ~ 그래서 나는 이름이 잘못된 함수를 발견하면 더 나은 이름이 떠오르는 즉시 바꾸라는 명령으로 받아들인다. 그래야 그 코드를 다시 볼 때 무슨 일을 하는지 '또' 고민하지 않게 된다.
-   180 좋은 이름을 떠올리는 데 효과적인 방법이 하나 있다. 바로 주석을 이용해 함수의 목적을 설명해보는 것이다. 그러다 보면 주석이 멋진 이름으로 바뀌어 되돌아올 때가 있다.
-   매개변수는 함수를 사용하는 문맥을 설정한다.
-   활용 범위가 넓어질 뿐만 아니라, 다른 모듈과의 결합coupling을 제거할 수도 있다.
-   185 나는 자바스크립트로 프로그래밍한다면, 호출문을 변경하기 전에 어서션을 추가10.6절하여 호출하는 곳에서 새로 추가한 매개변수를 실제로 사용하는지 확인한다.
-   186 새 함수의 이름을 나중에 기존 함수 이름으로 바꾸기 쉽도록 검색하기 좋은 이름을 붙여둔다.

## 6.6 변수 캡슐화하기 Encapsulate Variable

-   188 함수는 데이터보다 다루기가 수월하다.
-   반대로 데이터는 함수보다 다루기가 까다로운데
    -   유효범위가 넓어질수록 다루기 어려워진다. 전역 데이터가 골칫거리인 이유도 바로 여기에 있다.
-   그래서 접근할 수 있는 범위가 넓은 데이터를 옮길 때는 먼저 그 데이터로의 접근을 독점하는 함수를 만드는 식으로 캠슐화하는 것이 가장 좋은 방법일 때가 많다. 데이터 재구성이라는 어려운 작업을 함수 재구성이라는 더 단순한 작업으로 변환하는 것이다.
-   189 데이터 캡슐화는 다른 경우에도 도움을 준다. 데이터를 변경하고 사용하는 코드를 감사힐 수 있는 확실한 통로가 되어주기 때문에 데이터 변경 전 검증이나 변경 후 추가 로직을 쉽게 끼워 넣을 수 있다.
-   객체 지향에서 객체의 데이터를 항상 private으로 유지해야 한다고 ~

### **값 캡슐화하기**

-   191 기본 캡슐화 기법은 데이터 항목을 참조하는 부분만 캡슐화한다.
-   192 나는 주로 게터가 데이터의 복제본을 반환하도록 수정하는 식으로 처리한다.
    -   특히 리스트에 이 기법을 많이 적용한다. 데이터의 복제본을 반환하면 클라이언트는 게터로 얻는 데이터를 변경할 수 있지만 원본에는 아무 영향을 주지 못한다.
-   단, 주의할 점이 있다. 공유 데이터(원본)를 변경하기를 원하는 클라이언트가 있을 수 있다. ~ 이를 위한 좋은 방법이 레코드 캡슐화하기다.
-   세터에서도 복제본을 만드는 편이 좋을 수도 있다.
    -   링크가 필요 없다면 데이터를 복제해 저장하여 나중에 원본이 변경돼서 발생하는 사고를 방지할 수 있다.
    -   복제가 성능에 주는 영향은 대체로 미미하다.
-   193 복제본 만들기와 클래스로 감싸는 방식은 레코드 구조에서 깊이가 1인 속성들까지만 효과가 있다.
-   분명한 시실은 데이터의 사용 범위가 넓을수록 적절히 캡슐화하는 게 좋다는 것이다.

## 6.7 변수 이름 바꾸기 Rename Variable

-   194 물론 자바스크립트와 같은 동적 타입 언어라면 나는 이름 앞에 타입을 드러내는 문자를 붙이는 스타일을 선호한다. aCustomenr
-   함수 호출 한 번으로 끝나지 않고 값이 영속되는 필드라면 이름에 더 신경써야 한다.

### **절차** 195

    1. 폭넓게 쓰이는 변수라면 변수 캡슐화를 고려한다.
    2. - 변수 값이 변하지 않는다면 다른 이름으로 복제본을 만들어서 하나씩 점진적으로 변경한다.

### **예시**

```
let tpHd = "untitled";

result += `<h1>${tpHd}</h1>`;
tpHd = obj['articleTitle'];

// 변수 캡슐화하기

result += `<h1>${title()}</h1>`.
setTitle(obj['articleTitle']);

function title() {return tpHd}; // tpHd 변수의 게터
function setTitle(arg) {tpHd = arg}; // tpHd 변수의 세터

// 캡슐화 후에는 변수 이름을 바꿔도 된다.

let _title = "untitled";
function title() {return _title};
function setTitle(arg) {_title = arg}; // tpHd 변수의 세터
```

### **예시: 상수 이름 바꾸기**

-   196 나는 기존 이름을 삭제했다가 테스트에 실패하면 되돌리는 방식보다 새 이름을 선언한 다음 기존 이름에 복사하는 방식이 조금이라도 쉽다면 후자를 선택한다.
-   이 방식은 상수는 물론, 클라이언트가 볼 떄 읽기전용인 변수(가령 자바스크립트의 익스포트한 변수)에도 적용할 수 있다.

## 6.8 매개변수 객체 만들기 Intorduce Parameter Object

### **배경**

-   197 데이터 항목 여러 개가 이 함수에서 저 함수로 함께 몰려다니는 경우를 자주 본다. 나는 이런 데이터 무리를 발견하면 데이터 구조 하나로 모아주곤 한다.
-   하지만 이 리팩터링의 진정한 힘은 코드를 더 근본적으로 바꿔준다는 데 있다.

### **절차**

-   198 개인적으로 클래스로 만드는 걸 선호한다. 나중에 동작까지 묶기 좋기 때문이다. 나는 주로 데이터 구조를 값 객체 Value Object로 만든다.
-   함수 호출 시 새로운 데이터 구조 인스턴스를 넘기도록 수정한다.
-   201 코드에 범위 개념이 필요함을 깨달았다면 최댓값과 최솟값과 쌍을 사용하는 코드를 발견할 때마다 범위 객체로 바꾸자.

## 6.9 여러 함수를 클래스로 묶기 Combine Functions into Class

### **배경**

-   202 클래스는 데이터와 함수를 하나의 공유 환경으로 묶은 후, 다른 프로그램 요소와 어우러질 수 있도록 그중 일부를 외부에 제공한다. 클래스는 객체 지향 언어의 기본인 동시에 다른 패러다임 언어에도 유용하다.
-   나는 (흔히 함수 호출 시 인수로 전달되는) 공통 데이터를 중심으로 긴밀하게 엮여 작동하는 함수 무리를 발견하면 클래스 하나로 묶고 싶어진다. 클래스로 묶으면 이 함수들이 공유하는 공유 환경을 더 명확하게 표현할 수 있고, 각 함수에 전달되는 인수를 줄여서 객체 안에서의 함수 호출을 간결하게 만들 수 있다.
-   새로 만든 클래스와 관련하여 놓친 연산을 찾아서 새 클래스의 메서드로 뽑아내는 데도 좋다.
-   203 함수를 한데 묶는 또 다른 방법으로 여러 함수를 변환 함수로 묶기 6.10절 도 있다.
-   나는 중첩 함수보다 클래스를 선호하는 편인데, 중첩 함수는 테스트하기가 까다로울 수 있기 때문이다. 또한 한 울타리로 묶을 함수들 중 외부에 공개할 함수가 여러 개일 떄는 클래스를 사용할 수밖에 없다.
-   207 프로그램의 다른 부분에서 데이터를 갱신할 가능성이 꽤 있을 때는 클래스로 묶어두면 큰 도움이 된다.

## 6.10 여러 함수를 변환 함수로 묶기 Combine Functions into Transform

-   208 정보가 이용되는 곳마다 같은 도출 로직이 반복되기도 한다. 나는 이런 도출 작업들을 한데로 모아두길 좋아한다. 모아주면 검색과 갱신을 일관된 장소에서 처리할 수 있고 로직 중복도 막을 수 있다.
-   209 원본 데이터가 코드 안에서 갱신될 때는 클래스로 묶는 편이 훨씬 낫다. 변환 함수로 묶으면 가공한 데이터를 새로운 데이터에 저장하므로, 원본 데이터가 수정되면 일관성이 깨질 수 있기 때문이다.

### 절차

-   대체로 깊은 복사로 처리해야 한다. 변환 함수라 원본 레코드를 바꾸지 않는지 검사하는 테스트를 마련해주면 도움될 때가 많다.

### 예시

-   210 나는 본질은 같고 부가 정보만 덧붙이는 변환 함수의 이름을 "enrich"라고 하고, 형태가 변할 때만 "transform" 이라는 이름을 쓴다.
-   211 변환 함수 안에서는 결과 객체를 매번 복제할 필요 없이 마음껏 변경해도 된다.
-   enrichReading()처럼 정보를 추가해 반환할 때 원본 측정값 레코드는 변경하지 않아야 한다. 따라서 이를 확인하는 테스트를 작성해두는 것이 좋다.
