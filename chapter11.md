# Chapter 11 API 리팩터링

-   모듈과 함수는 소프트웨어를 구성하는 빌딩 블록이며, API는 이 블록들을 끼워 맞추는 연결부다.
-   좋은 API는 데이터를 갱신하는 함수와 그저 조회만 하는 함수를 명확히 구분한다.
    -   두 기능이 섞여 있다면 질의 함수와 변경 함수 분리하기를 적용해 갈라놔야 한다.
    -   값 하나 때문에 여러 개로 나뉜 함수들은 함수 매개변수화하기를 적용해 하나로 합칠 수 있다.
    -   한편, 어떤 매개변수는 그저 함수의 동작 모드를 전환하는 용도로만 쓰이는데, 이럴 때는 플래그 인수 제거하기를 적용하면 좋다.
-   데이터 구조가 함수 사이를 건너 다니면서 필요 이상으로 분해될 때는 객체 통째로 넘기기를 적용해 하나로 유지하면 깔끔해진다.
    -   매개변수를 질의 함수로 바꾸기, 질의 함수를 매개변수로 바꾸기
-   클래스는 대표적인 모듈이다.
    -   내가 만든 객체가 되도록 불변이길 원하므로 기회가 될 때마다 세터 제거하기를 적용한다.
    -   호출자에 새로운 객체를 만들어 반환하려 할 때 일반적인 생성자의 능력만으로는 부족할 때가 있다.
        -   이럴 때 생성자를 팩터리 함수로 바꾸기가 좋은 해법일 수 있다.
-   수많은 데이터를 받는 복잡한 함수를 잘게 쪼개는 문제
    -   함수를 명령으로 바꾸기, 명령을 함수로 바꾸기

<br>

## 11.1 질의 함수와 변경 함수 분리하기 Seperate Query from Modifier

### 배경

-   질의 함수(읽기 함수)는 모두 부수효과가 없어야 한다. 명령-질의 분리(command-query separation)
-   값을 반환하면서 부수효과도 있는 함수를 발견하면 상태를 변경하는 부분과 질의하는 부분을 분리하여 시도한다.
-   흔히 쓰는 최적화 기법 중 요청된 값을 캐시해두고 다음번 호출 때 빠르게 응답하는 방법이 있는데. 이러한 캐싱도 객체의 상태를 변경하지만 객체 밖에서는 관찰할 수 없다.
    -   즉, 겉보기 부수효과 없이 어떤 순서로 호출하든 모든 호출에 항상 똑같은 값을 반환할 뿐이다.

### 예시

-   훑어 악당 miscreant을 찾는 함수
-   악당을 찾으면 그 사람의 이름을 반환하고 경고를 울린다.
-   가장 먼저 찾은 악당만 취급한다.

-   [SeperateQueryFromModifier.js](./src/chp11/SeperateQueryFromModifier.js)
-   [SeperateQueryFromModifier.test.js](./test/chp11/SeperateQueryFromModifier.test.js)

<br>

## 11.2 함수 매개변수화하기 Parameterize Function

### 배경

-   두 함수의 로직이 아주 비슷하고 단지 리터럴 값만 다르다면, 그 다른 값만 매개변수로 받아 처리하는 함수 하나로 합쳐서 중복을 없앨 수 있다.

### 예시

-   [ParameterizeFunction.js](./src/chp11/ParameterizeFunction.js)
-   [ParameterizeFunction.test.js](./test/chp11/ParameterizeFunction.test.js)

<br>

## 11.3 플래그 인수 제거하기 Remove Flag Argument

### 배경

-   플래그 인수 flag argument란 호출되는 함수가 실행할 로직을 호출하는 쪽에서 선택하기 위해 전달하는 인수다.
-   플래그 인수를 싫어하는 이유
    -   호출할 수 있는 함수들이 무엇이고 어떻게 호출해야 하는지를 이해하기가 어려워지기 때문이다.
-   특정한 기능 하나만 수행하는 명시적인 함수를 제공하는 편이 훨씬 깔끔하다.
-   플래그 인수가 되려면
    -   호출하는 쪽에서 불리언 값으로 (프로그램에서 사용되는 데이터가 아닌) 리터럴 값을 건네야 한다.
    -   또한 호출되는 함수는 그 인수를 (다른 함수에서 전달하는 데이터가 아닌) 제어 흐름을 결정하는 데 사용해야 한다.
-   플래그 인수를 제거하면 코드가 깔끔해짐은 물론 프로그래밍 도구에도 도움을 준다.
-   함수 하나에서 플래그 인수를 두 개 이상 사용하면 플래그 인수를 써야 하는 합당한 근거가 될 수 있다.
    -   같은 로직을 조합해내는 더 간단한 함수를 만들 방법을 고민

### 예시

-   [RemoveFlagArgument.js](./src/chp11/RemoveFlagArgument.js)

### 예시 : 매개변수를 까다로운 방식으로 사용할 때

-   [RemoveFlagArgument2.js](./src/chp11/RemoveFlagArgument2.js)

<br>

## 11.4 객체 통째로 옮기기 Preserve Whole Object

-   하나의 레코드에서 값 두어 개를 가져와 인수로 넘기는 코드를 보면, 그 값들 대신 레코드를 통째로 넘기고 함수 본문에서 필요한 값들을 꺼내 쓰도록 수정하곤 한다.
-   레코드틀 통째로 넘기면 변화에 대응하기 쉽ㄴ다.
-   어떤 객체로부터 값 몇 개를 얻은 후 그 값들만으로 무언가를 하는 로직이 있다면, 그 로직을 객체 안으로 집어넣어야 함을 알려주는 악취로 봐야 한다.
    -   그래서 객체 통째로 넘기기는 특히 매개변수 객체 만들기 6.8절 후, 즉 산재한 수많은 데이터 더미를 새로운 객체로 묶은 후 적용하곤 한다.
-   한편, 한 객체가 제공하는 기능 중 항상 똑같은 일부만을 사용하는 코드가 많다면, 그 기능만 따로 묶어서 클래스로 추출하라는 신호일 수 있다.
-   많은 사람이 놓치는 사례가 하나 더 있다. 다른 객체의 메서드를 호출하면서 호출하는 객체 자신이 가지고 있는 데이터 여러 개를 건네는 경우다.
    -   이런 상황이면 데이터 여러 개 대신 객체 자신의 참조만 건네도록 수정할 수 있다 (자바스크립트라면 this를 건넬 것이다).

### 예시

-   [PreserveWholeObject.js](./src/chp11/PreserveWholeObject.js.js)

### 예시 : 새 함수를 다른 방식으로 만들기
